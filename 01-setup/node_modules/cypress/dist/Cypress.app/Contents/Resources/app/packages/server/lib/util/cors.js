(function() {
  var _, debug, localHostOrIpAddressRe, parseDomain, url;

  _ = require("lodash");

  url = require("url");

  debug = require("debug")("cypress:server:cors");

  parseDomain = require("parse-domain");

  localHostOrIpAddressRe = /.?localhost|\.local|^[\d\.]+$/;

  module.exports = {
    parseUrlIntoDomainTldPort: function(str) {
      var hostname, obj, parsed, port, protocol, ref, segments;
      ref = url.parse(str), hostname = ref.hostname, port = ref.port, protocol = ref.protocol;
      if (port == null) {
        port = protocol === "https:" ? "443" : "80";
      }
      if (!(parsed = parseDomain(hostname, {
        privateTlds: true,
        customTlds: localHostOrIpAddressRe
      }))) {
        segments = hostname.split(".");
        parsed = {
          tld: segments[segments.length - 1],
          domain: segments[segments.length - 2]
        };
      }
      obj = {};
      obj.port = port;
      obj.tld = parsed.tld;
      obj.domain = parsed.domain;
      debug("Parsed URL %o", obj);
      return obj;
    },
    urlMatchesOriginPolicyProps: function(url, props) {
      var parsedUrl;
      if (!props) {
        return false;
      }
      parsedUrl = this.parseUrlIntoDomainTldPort(url);
      return _.isEqual(parsedUrl, props);
    }
  };

}).call(this);
